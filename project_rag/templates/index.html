<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <title>AI Chatbot ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</title>
  <link rel="stylesheet" href="../static/style.css">
  <style>

  </style>
</head>

<body>

  <!-- ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ -->
  <div class="chat-product-container">
    <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
    <div class="product-box">

      <form id="addForm" class="inputform">
        <h2> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
        <label for="product">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
        <input type="text" name="product" id="product" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" required>

        <label for="detail">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
        <textarea name="detail" id="detail" rows="4" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" required></textarea>

        <div class="input-row">
          <div class="input-group">
            <label for="price">‡∏£‡∏≤‡∏Ñ‡∏≤</label>
            <input type="number" name="price" id="price" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" required>
          </div>
          <div class="input-group">
            <label for="quantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
            <input type="number" name="quantity" id="quantity" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" required>
          </div>
          <div class="input-group">
            <label for="category">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
            <select name="category" id="category" required>
              <option value="" disabled selected>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà --</option>
              <option value="‡πÇ‡∏ô‡πâ‡∏ï‡∏ö‡∏∏‡πä‡∏Ñ/‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå">‡πÇ‡∏ô‡πâ‡∏ï‡∏ö‡∏∏‡πä‡∏Ñ/‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</option>
              <option value="‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ï‡πà‡∏≠‡∏û‡πà‡∏ß‡∏á">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ï‡πà‡∏≠‡∏û‡πà‡∏ß‡∏á</option>
              <option value="‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏û‡∏Å‡∏û‡∏≤/‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏û‡∏Å‡∏û‡∏≤/‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠</option>
              <option value="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÉ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÉ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô</option>
              <option value="‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</option>
            </select>
          </div>

        </div>

        <button type="submit">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
      </form>


      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
              <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
              <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
              <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
            </tr>
          </thead>
          <tbody>
            {% for name, detail, price, qty in products %}
            <tr>
              <td>{{ name }}</td>
              <td>{{ detail }}</td>
              <td>{{ price }}</td>
              <td>{{ qty }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>



    </div>



    <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏ä‡∏ó AI -->
    <div class="chatbox">
      <h2>üí¨ AI Chat bot</h2>
      <div class="chat-body">
        {% if history %}
        {% for item in history %}
        {% if item.role == 'user' %}
        <div class="message user-message">
          <div class="message-text">{{ item.content }}</div>
        </div>
        {% elif item.role == 'assistant' %}
        <div class="message bot-message">
          <div class="message-text"><strong>AI:</strong> {{ item.content }}</div>
        </div>
        {% endif %}
        {% endfor %}
        {% endif %}
      </div>

      <form method="POST" class="chat-form" id="chat-form">
        <div class="chat-input-group">
          <textarea id="message" name="message" class="message-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°..." required></textarea>
          <div class="chat-buttons">
            <button type="submit" class="send-btn">‡∏™‡πà‡∏á</button>
            <button type="button" class="send-btn reset-btn" onclick="resetChat()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
          </div>
        </div>
      </form>

    </div>
  </div>

  <script>
    function resetChat() {
      fetch('/reset', { method: 'POST' })
        .then(() => {
          document.querySelector(".chat-body").innerHTML = ""; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ä‡∏ó
          document.getElementById("message").value = "";        // ‡∏•‡πâ‡∏≤‡∏á input
        });
    }

  </script>




  </div>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    document.getElementById("addForm").addEventListener("submit", async function (e) {
      e.preventDefault(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ reload ‡∏´‡∏ô‡πâ‡∏≤

      const formData = new FormData(this);

      try {
        const res = await fetch("/add", {
          method: "POST",
          body: formData
        });

        const text = await res.text();

        if (res.ok) {
          Swal.fire({
            icon: "success",
            title: "‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!",
            text: text,
            timer: 2000,
            showConfirmButton: false
          }).then(() => {
            location.reload(); // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
          });
        } else {
          throw new Error(text);
        }

      } catch (err) {
        Swal.fire({
          icon: "error",
          title: "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î",
          text: err.message
        });
      }
    });
  </script>

</body>

</html>